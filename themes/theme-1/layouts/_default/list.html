{{- define "main" }}

{{ $pages := union .RegularPages .Sections }}
{{ $pages = where site.RegularPages "Type" "in" site.Params.mainSections }}
{{ $paginator := .Paginate $pages }}
{{ $term := .Data.Term}}


{{ if (and $.IsHome (.Site.Params.homeInfoParams) (eq $paginator.PageNumber 1)) }}
{{- partial "home_info.html" . }}
{{ end }}

<p class="introducart">
	{{ $n := len $pages }}
	{{ $n }} articles
	{{ partial "pagination.html" $paginator }}
</p>

{{ range $page := $paginator.Pages }}
{{ $class := "post-entry" }}

<article class="{{ $class }}" role="article">
  
    <div class="post-entry-content-left">
		{{- partial "cover.html" (dict "cxt" . "IsHome" true) }}
	</div>
	
	<div class="post-entry-content-right">
		<header class="entry-header">
			<h2>
			  {{ .Title }}
			  {{- if .Draft }}<sup class="entry-isdraft">&nbsp;&nbsp;[brouillon]</sup>
			  {{- end }}
			</h2>
		</header>
		{{- if (ne .Site.Params.hideSummary true)}}
		<section class="entry-content">
      <p class="justify" >{{ .Summary | plainify | htmlUnescape }}</p>
		</section>
		{{- end }}
    <!--- entry-taxonomies --->
    {{ if (.GetTerms "Thème") }}
    <section class="entry-taxonomies">
    
    {{ range (.GetTerms "Thème") }}
      [{{ .LinkTitle }}]
      {{ $term }} 
    {{ end }}
    </section>
    {{ end }}
    <!--- entry-taxonomies END --->
    <footer class="entry-footer">
      {{- partial "post_meta.html" . -}}
    </footer>
	</div>
  <a class="entry-link" aria-label="{{ .Title | plainify }}" href="{{ .Permalink }}" title="{{ .Title | plainify }}"></a>
</article>

{{- end }}

{{- if gt $paginator.TotalPages 1 }}
  <div class="pagination">
    {{- if $paginator.HasPrev }}
    <a class="prev" rel="prev" href="{{ $paginator.Prev.URL }}" title="Page Précédente" >« Page Précédente</a>
    {{- end }}
    {{- if $paginator.HasNext }}
    <a class="next"  rel="next" href="{{ $paginator.Next.URL }}" title="Page Suivante">Page Suivante »</a>
    {{- end }}
  </div>
{{- end }}


{{- end  }}{{- /* end main */ -}}
